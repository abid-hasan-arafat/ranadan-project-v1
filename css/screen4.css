/* ══════════════════════════════════════════════════════
   SCREEN 4 — THE ROOFTOP
══════════════════════════════════════════════════════ */
#s4 .sky {
  position:absolute; inset:0;
  background:
    radial-gradient(ellipse at 72% 8%,rgba(18,30,80,.9) 0%,transparent 45%),
    radial-gradient(ellipse at 25% 15%,rgba(12,22,60,.7) 0%,transparent 40%),
    radial-gradient(ellipse at 50% 0%,#0b1438 0%,#060c28 35%,#030714 70%,#010208 100%);
}
#s4 #s4Stars { position:absolute; inset:0; width:100%; height:100%; }
#s4 .moon-wrap { position:absolute; top:6%; right:18%; }
#s4 .crescent { position:relative; width:80px; height:80px; }
#s4 .crescent .mf {
  position:absolute; inset:0; border-radius:50%;
  background:radial-gradient(circle at 36% 33%,#fffbe8 0%,#f5dfa0 28%,#e8c97a 58%,#b8860b 100%);
  box-shadow:0 0 40px rgba(232,201,122,.85),0 0 100px rgba(232,201,122,.4),0 0 200px rgba(200,150,40,.18);
  animation:mp 4s ease-in-out infinite;
}
#s4 .crescent .mb { position:absolute; border-radius:50%; width:65px; height:65px; top:5px; left:16px; background:#030714; }
#s4 .moon-halo { position:absolute; width:180px; height:180px; top:50%; left:50%; transform:translate(-50%,-50%); border-radius:50%; background:radial-gradient(circle,rgba(232,201,122,.055) 0%,transparent 70%); animation:mp 4s ease-in-out infinite; }
#s4 .atmo {
  position:absolute; inset:0;
  background:linear-gradient(to bottom,transparent 0%,transparent 30%,rgba(8,16,40,.2) 52%,rgba(10,20,35,.55) 68%,rgba(5,10,22,.82) 82%,rgba(2,5,14,1) 100%);
}
#s4 .city  { position:absolute; bottom:0; left:-4%; right:-4%; height:48%; }
#s4 .city svg { width:100%; height:100%; display:block; }
#s4 .rooftopFloor { position:absolute; bottom:0; left:0; right:0; height:42%; }
#s4 .rooftopFloor svg { width:100%; height:100%; display:block; }
#s4 .lanternLayer { position:absolute; top:32%; left:0; right:0; height:12%; pointer-events:none; }
#s4 .vignette { position:absolute; inset:0; background:radial-gradient(ellipse at 50% 50%,transparent 40%,rgba(0,0,0,.28) 68%,rgba(0,0,0,.7) 100%); pointer-events:none; }

/* ── CHARACTERS ── */
#s4 .charsLayer {
  position:absolute; bottom:20%; left:0; right:0; height:52%;
  display:flex; align-items:flex-end; justify-content:center;
  gap:clamp(.8rem,3.5vw,3.5rem); padding:0 clamp(.8rem,5vw,7rem);
  pointer-events:none;
}
.char { position:relative; display:flex; flex-direction:column; align-items:center; pointer-events:all; cursor:pointer; flex:0 0 auto; }
.charFig { position:relative; width:clamp(55px,8.5vw,105px); height:clamp(105px,16vw,190px); transition:filter .6s ease,opacity .6s ease; }

/* ghost mode */
.char.ghostMode .charFig {
  filter:brightness(0) invert(1) blur(.5px); opacity:.18;
  animation:ghostPulse 2.8s ease-in-out infinite;
}
@keyframes ghostPulse {
  0%,100%{opacity:.18;filter:brightness(0) invert(1) blur(.5px) drop-shadow(0 0 12px rgba(200,220,255,.5))}
  50%    {opacity:.28;filter:brightness(0) invert(1) blur(.3px) drop-shadow(0 0 22px rgba(200,220,255,.8))}
}
/* materialise */
.char.matAnim .charFig { animation:materialize 1.8s ease forwards !important; }
@keyframes materialize {
  0%  {filter:brightness(0) invert(1) blur(.5px);opacity:.2;transform:scale(.96)}
  40% {filter:brightness(1.4) saturate(.4) blur(.3px);opacity:.7}
  70% {filter:brightness(1.1) saturate(.8) blur(.1px);opacity:.95}
  100%{filter:brightness(1) saturate(1) blur(0);opacity:1;transform:scale(1)}
}
/* online */
.char.online .charFig { filter:none; opacity:1; animation:breathe 5s ease-in-out infinite; }
@keyframes breathe { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-5px)} }

/* name card */
.nameCard {
  position:absolute; bottom:calc(100% + 16px); left:50%;
  transform:translateX(-50%) translateY(8px);
  background:rgba(8,12,28,.92); border:1px solid rgba(232,201,122,.22); border-radius:10px;
  padding:.6rem 1rem; text-align:center; white-space:nowrap;
  opacity:0; pointer-events:none;
  transition:opacity .35s ease, transform .35s ease;
  backdrop-filter:blur(12px);
  box-shadow:0 8px 30px rgba(0,0,0,.6),0 0 20px rgba(232,201,122,.05);
  z-index:100; min-width:128px;
}
.nameCard::after { content:''; position:absolute; top:100%; left:50%; transform:translateX(-50%); border:6px solid transparent; border-top-color:rgba(232,201,122,.18); }
.char:hover .nameCard { opacity:1; transform:translateX(-50%) translateY(0); }
.nc-name  { font-family:'Amiri',serif; font-size:.96rem; color:rgba(232,201,122,.95); margin-bottom:.18rem; }
.nc-role  { font-family:'Space Mono',monospace; font-size:.52rem; letter-spacing:.12em; text-transform:uppercase; color:rgba(150,140,110,.55); margin-bottom:.32rem; }
.nc-msg   { font-family:'Cormorant Garamond',serif; font-style:italic; font-size:.8rem; color:rgba(200,185,150,.68); line-height:1.4; max-width:155px; }
.nc-stat  { margin-top:.38rem; font-family:'Space Mono',monospace; font-size:.5rem; letter-spacing:.1em; }
.ncOnline  { color:rgba(100,220,150,.82); }
.ncOffline { color:rgba(180,190,220,.45); }

/* online dot */
.onlineDot {
  position:absolute; bottom:-4px; right:-4px; width:10px; height:10px;
  border-radius:50%; border:1.5px solid rgba(8,12,28,.9);
  transition:background .5s,box-shadow .5s;
}
.char.online    .onlineDot { background:#64dc96; box-shadow:0 0 8px rgba(100,220,150,.7); animation:dotPulse 2s ease-in-out infinite; }
.char.ghostMode .onlineDot { background:rgba(180,190,220,.28); box-shadow:none; animation:none; }
@keyframes dotPulse { 0%,100%{box-shadow:0 0 6px rgba(100,220,150,.6)} 50%{box-shadow:0 0 14px rgba(100,220,150,1)} }

/* ── CINEMATIC CHAT ── */
#chatPanel {
  position:fixed; right:0; top:0; bottom:0;
  width:clamp(250px,22vw,320px); z-index:200;
  display:flex; flex-direction:column; padding:1.4rem .75rem .9rem;
  pointer-events:none; opacity:0; transition:opacity 1s ease;
}
#chatPanel.show { opacity:1; }
.chatHeader {
  font-family:'Space Mono',monospace; font-size:.55rem; letter-spacing:.2em;
  text-transform:uppercase; color:rgba(232,201,122,.38);
  margin-bottom:.9rem; padding-bottom:.45rem;
  border-bottom:1px solid rgba(232,201,122,.07);
  pointer-events:all;
}
#chatMessages {
  flex:1; display:flex; flex-direction:column; justify-content:flex-end;
  gap:.55rem; overflow:hidden;
  mask-image:linear-gradient(to bottom,transparent 0%,black 22%);
}
.chatMsg { opacity:0; transform:translateY(10px); animation:msgIn .5s ease forwards; }
@keyframes msgIn { to{opacity:1;transform:translateY(0)} }
.chatMsg.fading { opacity:0 !important; transition:opacity 2s ease; }
.msgWho { font-family:'Space Mono',monospace; font-size:.5rem; letter-spacing:.12em; text-transform:uppercase; margin-bottom:.22rem; }
.msgText {
  font-family:'Cormorant Garamond',serif; font-size:clamp(.82rem,1.5vw,.96rem);
  font-style:italic; color:rgba(220,210,185,.82); line-height:1.55;
  padding:.5rem .8rem; background:rgba(12,18,40,.52); border-left:2px solid;
  backdrop-filter:blur(8px); border-radius:0 8px 8px 0;
}
.msg-you    .msgWho{color:rgba(232,201,122,.72)} .msg-you    .msgText{border-color:rgba(232,201,122,.42)}
.msg-ghost  .msgWho{color:rgba(200,215,255,.62)} .msg-ghost  .msgText{border-color:rgba(200,215,255,.28)}
.msg-mona   .msgWho{color:rgba(255,150,180,.62)} .msg-mona   .msgText{border-color:rgba(255,150,180,.28)}
.msg-dounya .msgWho{color:rgba(100,210,200,.62)} .msg-dounya .msgText{border-color:rgba(100,210,200,.28)}
.chatInputWrap { margin-top:.75rem; display:flex; gap:.45rem; pointer-events:all; }
.chatInput {
  flex:1; background:rgba(10,15,35,.7); border:1px solid rgba(232,201,122,.16); border-radius:8px;
  padding:.52rem .72rem; font-family:'Cormorant Garamond',serif; font-size:.88rem; font-style:italic;
  color:rgba(220,210,185,.9); outline:none; backdrop-filter:blur(10px); transition:border-color .3s;
}
.chatInput::placeholder { color:rgba(180,165,130,.28); }
.chatInput:focus { border-color:rgba(232,201,122,.38); }
.chatSend {
  width:34px;height:34px; border-radius:8px; background:rgba(232,201,122,.1);
  border:1px solid rgba(232,201,122,.22); color:rgba(232,201,122,.78); font-size:1rem;
  cursor:pointer; transition:background .3s,border-color .3s; display:flex;align-items:center;justify-content:center;
}
.chatSend:hover{background:rgba(232,201,122,.2);border-color:rgba(232,201,122,.48)}

/* ── IFTAR TIMER ── */
#iftarWrap {
  position:fixed; top:1.5rem; left:1.5rem; z-index:200;
  background:rgba(8,12,30,.72); border:1px solid rgba(232,201,122,.16); border-radius:12px;
  padding:.75rem 1.15rem; backdrop-filter:blur(12px); box-shadow:0 8px 30px rgba(0,0,0,.5);
  opacity:0; transition:opacity 1s ease;
}
#iftarWrap.show { opacity:1; }
.iftarLabel { font-family:'Space Mono',monospace; font-size:.5rem; letter-spacing:.2em; text-transform:uppercase; color:rgba(200,180,130,.42); margin-bottom:.32rem; }
#iftarTime { font-family:'Cormorant Garamond',serif; font-size:clamp(1.4rem,3vw,1.85rem); font-weight:300; color:rgba(232,201,122,.94); letter-spacing:.08em; line-height:1; }
.iftarSub { font-family:'Amiri',serif; font-size:.75rem; color:rgba(180,165,120,.48); margin-top:.18rem; }

/* Iftar celebration */
#iftarCelebration {
  position:fixed; inset:0; z-index:500; display:flex; align-items:center; justify-content:center;
  flex-direction:column; gap:1rem; background:rgba(2,5,18,.88);
  opacity:0; pointer-events:none; transition:opacity 1.5s ease; backdrop-filter:blur(4px);
}
#iftarCelebration.show{opacity:1;pointer-events:all}
#iftarCelebration h2{font-family:'Amiri',serif;font-size:clamp(2rem,6vw,4rem);color:rgba(232,201,122,.95);text-align:center;animation:celebFloat 3s ease-in-out infinite}
@keyframes celebFloat{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
#iftarCelebration p{font-family:'Cormorant Garamond',serif;font-style:italic;font-size:clamp(.95rem,2.5vw,1.4rem);color:rgba(200,185,150,.68);letter-spacing:.1em}
.closeBtn{margin-top:1rem;font-family:'Cormorant Garamond',serif;font-size:.82rem;letter-spacing:.25em;text-transform:uppercase;color:rgba(232,201,122,.58);background:transparent;border:1px solid rgba(232,201,122,.18);padding:.55rem 1.5rem;border-radius:999px;cursor:pointer}

/* ── PRESENCE PANEL ── */
#presencePanel {
  position:fixed; bottom:1.5rem; left:1.5rem; z-index:200;
  background:rgba(8,12,30,.75); border:1px solid rgba(232,201,122,.1); border-radius:12px;
  padding:.75rem .95rem; backdrop-filter:blur(12px);
  opacity:0; transition:opacity 1s ease;
}
#presencePanel.show{opacity:1}
.ppLabel{font-family:'Space Mono',monospace;font-size:.48rem;letter-spacing:.18em;text-transform:uppercase;color:rgba(180,165,120,.32);margin-bottom:.52rem}
.presBtns{display:flex;flex-direction:column;gap:.38rem}
.presBtn{display:flex;align-items:center;gap:.55rem;background:transparent;border:none;cursor:pointer;padding:.28rem 0;font-family:'Cormorant Garamond',serif;font-size:.83rem;color:rgba(200,185,150,.55);transition:color .3s}
.presBtn:hover{color:rgba(232,201,122,.88)}
.presDot{width:8px;height:8px;border-radius:50%;background:rgba(180,190,220,.28);transition:background .4s,box-shadow .4s;flex-shrink:0}
.presBtn.on .presDot{background:#64dc96;box-shadow:0 0 8px rgba(100,220,150,.8)}
.presBtn.on{color:rgba(220,210,180,.82)}
